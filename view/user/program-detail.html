<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Program Details - UniRecommend</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        accent: '#F59E0B',
                        'light-blue': '#EFF6FF',
                        'lighter-blue': '#DBEAFE',
                        'gray-border': '#E5E7EB',
                        'gray-medium': '#6B7280',
                        'dark-bg': '#1F2937',
                        'dark-nav': '#374151',
                        'dark-text': '#F3F4F6',
                        'muted-text': '#D1D5DB'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="/css/style.css">
    <!-- Added layout loader config + index.js -->
    <script>
        window.__LAYOUT_PATHS__ = [
            'user/partials/layout.html',
            'view/user/partials/layout.html',
            '/view/user/partials/layout.html'
        ];
    </script>
    <script defer src="/js/index.js"></script>
</head>
<body class="bg-white text-gray-800 flex flex-col min-h-screen">

<!-- Navigation -->
<div id="navbarContainer"></div>

<!-- Main Content -->
<main class="flex-1 py-8">
    <!-- Loading State -->
    <div id="loadingState" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center py-16">
            <div class="inline-flex items-center px-4 py-2 text-sm text-gray-600">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Loading program details...
            </div>
        </div>
    </div>

    <!-- Error State -->
    <div id="errorState" class="hidden max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center py-16">
            <div class="text-red-600 mb-4">
                <svg class="mx-auto h-16 w-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.996-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 mb-4">Program Not Found</h3>
            <p class="text-gray-600 mb-6">The program you're looking for could not be found or does not exist.</p>
            <div class="space-x-4">
                <a href="/programs" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary hover:bg-blue-600 transition">
                    Browse Programs
                </a>
                <a href="/home" class="inline-flex items-center px-6 py-3 border border-primary text-base font-medium rounded-lg text-primary bg-white hover:bg-primary hover:text-white transition">
                    Go Home
                </a>
            </div>
        </div>
    </div>

    <!-- Program Detail Content -->
    <div id="programContent" class="hidden max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="mb-8" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2 text-sm text-gray-500">
                <li><a href="/home" class="hover:text-primary transition">Home</a></li>
                <li><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg></li>
                <li><a href="/programs" class="hover:text-primary transition">Programs</a></li>
                <li><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg></li>
                <li class="text-gray-900 font-medium" id="breadcrumbProgramName">Program Details</li>
            </ol>
        </nav>

        <!-- Program Header -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-border p-8 mb-8">
            <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6">
                <div class="flex-1">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-primary/20 to-accent/20 rounded-xl flex items-center justify-center">
                            <span class="text-2xl">ðŸŽ“</span>
                        </div>
                        <div>
                            <h1 id="programTitle" class="text-3xl font-bold text-gray-900 mb-2">Program Name</h1>
                            <div class="flex flex-wrap gap-3">
                                <span id="degreeLevel" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary/10 text-primary">Bachelor</span>
                                <span id="fieldOfStudy" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">Field of Study</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-4m-5 0H9m0 0H5m6 0v-4a2 2 0 011-1h2a2 2 0 011 1v4M7 7h10M7 10h10M7 13h10"/>
                            </svg>
                            <span id="universityName">University Name</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span id="location">Country</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <span id="duration">Duration</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"/>
                            </svg>
                            <span id="language">Language</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                            </svg>
                            <span id="tuitionFee">Tuition Fee</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4M5 7h14a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V9a2 2 0 012-2z"/>
                            </svg>
                            <span id="applicationDeadline">Application Deadline</span>
                        </div>
                    </div>
                </div>
                
                <div class="lg:w-80 space-y-4">
                    <button id="applyNowBtn" class="w-full bg-gradient-to-r from-primary to-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:opacity-90 transition">
                        Apply Now
                    </button>
                    <button id="saveToFavoritesBtn" class="w-full border border-primary text-primary py-3 px-6 rounded-lg font-medium hover:bg-primary hover:text-white transition">
                        Save to Favorites
                    </button>
                    <button id="shareBtn" class="w-full border border-gray-300 text-gray-700 py-3 px-6 rounded-lg font-medium hover:bg-gray-50 transition">
                        Share Program
                    </button>
                </div>
            </div>
        </div>

        <!-- Content Tabs -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-border">
            <!-- Tab Navigation -->
            <div class="border-b border-gray-border">
                <nav class="flex space-x-8 px-8" aria-label="Tabs">
                    <button class="tab-btn active py-4 px-2 border-b-2 border-primary text-primary font-medium text-sm" data-tab="overview">
                        Overview
                    </button>
                    <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm" data-tab="requirements">
                        Requirements
                    </button>
                    <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm" data-tab="curriculum">
                        Curriculum
                    </button>
                    <button class="tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm" data-tab="admission">
                        Admission
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="p-8">
                <!-- Overview Tab -->
                <div id="overview-tab" class="tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Program Description</h3>
                            <div id="programDescription" class="text-gray-600 leading-relaxed mb-6">
                                Program description will be loaded here...
                            </div>
                            
                            <h3 class="text-xl font-semibold mb-4">Key Highlights</h3>
                            <ul id="keyHighlights" class="space-y-2 text-gray-600">
                                <!-- Dynamic highlights -->
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Program Facts</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-600">Start Date</span>
                                    <span id="startDate" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-600">Duration</span>
                                    <span id="programDuration" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-600">Study Mode</span>
                                    <span class="font-medium">Full-time</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-600">Language</span>
                                    <span id="programLanguage" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-600">Application Fee</span>
                                    <span class="font-medium">Contact University</span>
                                </div>
                            </div>
                            
                            <div class="mt-8">
                                <h3 class="text-xl font-semibold mb-4">University Information</h3>
                                <div id="universityInfo" class="bg-gray-50 rounded-lg p-4">
                                    <!-- University details -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Requirements Tab -->
                <div id="requirements-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Academic Requirements</h3>
                            <div id="academicRequirements" class="space-y-4">
                                <!-- Dynamic requirements -->
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Language Requirements</h3>
                            <div id="languageRequirements" class="space-y-4">
                                <!-- Dynamic language requirements -->
                            </div>
                            
                            <h3 class="text-xl font-semibold mb-4 mt-8">Test Score Requirements</h3>
                            <div id="testScoreRequirements" class="space-y-4">
                                <!-- Dynamic test score requirements -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Curriculum Tab -->
                <div id="curriculum-tab" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Course Structure</h3>
                    <p class="text-gray-600 mb-6">Detailed curriculum information will be available soon. Please contact the university for specific course details.</p>
                    
                    <div class="bg-light-blue/50 rounded-lg p-6">
                        <h4 class="font-semibold mb-2">Contact University for Curriculum Details</h4>
                        <p class="text-sm text-gray-600">For detailed course structure, syllabus, and curriculum information, please reach out to the university admissions office.</p>
                    </div>
                </div>

                <!-- Admission Tab -->
                <div id="admission-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Application Process</h3>
                            <ol class="space-y-3 text-gray-600">
                                <li class="flex items-start">
                                    <span class="inline-flex items-center justify-center w-6 h-6 bg-primary text-white text-xs font-bold rounded-full mr-3 mt-0.5">1</span>
                                    <span>Submit online application form</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="inline-flex items-center justify-center w-6 h-6 bg-primary text-white text-xs font-bold rounded-full mr-3 mt-0.5">2</span>
                                    <span>Upload required documents</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="inline-flex items-center justify-center w-6 h-6 bg-primary text-white text-xs font-bold rounded-full mr-3 mt-0.5">3</span>
                                    <span>Pay application fee</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="inline-flex items-center justify-center w-6 h-6 bg-primary text-white text-xs font-bold rounded-full mr-3 mt-0.5">4</span>
                                    <span>Await admission decision</span>
                                </li>
                            </ol>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold mb-4">Important Dates</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-600">Application Deadline</span>
                                    <span id="admissionDeadline" class="font-medium">-</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-600">Decision Notification</span>
                                    <span class="font-medium">4-6 weeks after deadline</span>
                                </div>
                                <div class="flex justify-between py-2 border-b border-gray-100">
                                    <span class="text-gray-600">Program Start</span>
                                    <span id="admissionStartDate" class="font-medium">-</span>
                                </div>
                            </div>
                            
                            <div class="mt-8">
                                <h3 class="text-xl font-semibold mb-4">Contact Admissions</h3>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <p class="text-sm text-gray-600 mb-3">For questions about admission requirements and process:</p>
                                    <button class="text-primary hover:text-blue-600 font-medium text-sm">Contact Admissions Office</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Similar Programs -->
        <div class="mt-12">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold">Similar Programs</h2>
                <a href="/programs" class="text-primary hover:text-blue-600 font-medium">View All Programs</a>
            </div>
            <div id="similarPrograms" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Similar programs will be loaded here -->
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<div id="footerContainer"></div>

<script>
    let currentProgram = null;

    document.addEventListener('DOMContentLoaded', function() {
        // Wait a bit for index.js to fully load
        setTimeout(() => {
            initializePage();
        }, 100);
    });

    function initializePage() {
        setupTabNavigation();
        loadProgramDetails();
    }

    function setupTabNavigation() {
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetTab = button.getAttribute('data-tab');
                
                // Update button states
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-primary', 'text-primary');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                button.classList.add('active', 'border-primary', 'text-primary');
                button.classList.remove('border-transparent', 'text-gray-500');
                
                // Update content visibility
                tabContents.forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
            });
        });
    }

    async function loadProgramDetails() {
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const programContent = document.getElementById('programContent');

        // Show loading state
        loadingState.classList.remove('hidden');
        errorState.classList.add('hidden');
        programContent.classList.add('hidden');

        try {
            // Get program ID from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const programId = urlParams.get('id') || urlParams.get('program_id');

            if (!programId) {
                throw new Error('No program ID provided');
            }

            // Check if required functions are available
            if (typeof getToken !== 'function' || typeof apiCall !== 'function') {
                console.error('Authentication functions not available. Waiting for index.js to load...');
                setTimeout(loadProgramDetails, 500);
                return;
            }

            // Fetch program details
            console.log('Loading program details for ID:', programId);
            const program = await apiCall(`/programs/${programId}`);
            
            if (!program) {
                throw new Error('Program not found');
            }

            currentProgram = program;
            populateProgramDetails(program);
            loadSimilarPrograms(program.id);

            loadingState.classList.add('hidden');
            programContent.classList.remove('hidden');

        } catch (error) {
            console.error('Error loading program details:', error);
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
        }
    }

    function populateProgramDetails(program) {
        // Update page title and breadcrumb
        document.title = `${program.name} - UniRecommend`;
        document.getElementById('breadcrumbProgramName').textContent = program.name;

        // Header information
        document.getElementById('programTitle').textContent = program.name;
        document.getElementById('degreeLevel').textContent = program.degree_level || 'Program';
        document.getElementById('fieldOfStudy').textContent = program.field_of_study || 'Field of Study';
        document.getElementById('universityName').textContent = program.university?.name || 'University';
        document.getElementById('location').textContent = program.university?.region?.name || 'Location';
        document.getElementById('duration').textContent = program.duration_years ? `${program.duration_years} years` : 'Duration not specified';
        document.getElementById('language').textContent = program.language || 'Language not specified';
        
        // Tuition fee
        const tuitionDisplay = program.tuition_fee 
            ? `${program.currency || ''} ${parseFloat(program.tuition_fee).toLocaleString()}`
            : 'Contact university for fees';
        document.getElementById('tuitionFee').textContent = tuitionDisplay;
        
        // Dates
        document.getElementById('applicationDeadline').textContent = program.application_deadline 
            ? new Date(program.application_deadline).toLocaleDateString()
            : 'Contact university';

        // Overview tab
        document.getElementById('programDescription').textContent = program.description || 'Program description not available. Please contact the university for detailed information.';
        document.getElementById('startDate').textContent = program.start_date 
            ? new Date(program.start_date).toLocaleDateString()
            : 'Contact university';
        document.getElementById('programDuration').textContent = program.duration_years ? `${program.duration_years} years` : 'Contact university';
        document.getElementById('programLanguage').textContent = program.language || 'Contact university';
        document.getElementById('admissionDeadline').textContent = program.application_deadline 
            ? new Date(program.application_deadline).toLocaleDateString()
            : 'Contact university';
        document.getElementById('admissionStartDate').textContent = program.start_date 
            ? new Date(program.start_date).toLocaleDateString()
            : 'Contact university';

        // Key highlights
        const highlights = [
            `${program.degree_level} degree program`,
            `Duration: ${program.duration_years || 'Variable'} years`,
            `Language: ${program.language || 'Multiple'}`,
            `Field: ${program.field_of_study || 'Interdisciplinary'}`
        ];
        
        const highlightsList = document.getElementById('keyHighlights');
        highlightsList.innerHTML = highlights.map(highlight => 
            `<li class="flex items-center"><svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>${highlight}</li>`
        ).join('');

        // University info
        const universityInfo = document.getElementById('universityInfo');
        universityInfo.innerHTML = `
            <h4 class="font-semibold mb-2">${program.university?.name || 'University'}</h4>
            <p class="text-sm text-gray-600 mb-2">${program.university?.region?.name || 'Location'}</p>
            <p class="text-sm text-gray-600">${program.university?.description || 'University information not available.'}</p>
            ${program.university?.website ? `<a href="${program.university.website}" target="_blank" class="text-primary hover:text-blue-600 text-sm font-medium mt-2 inline-block">Visit University Website</a>` : ''}
        `;

        // Requirements
        populateRequirements(program.requirements || []);
    }

    function populateRequirements(requirements) {
        const academicReqs = document.getElementById('academicRequirements');
        const languageReqs = document.getElementById('languageRequirements');
        const testScoreReqs = document.getElementById('testScoreRequirements');

        // Group requirements by type
        const academic = requirements.filter(req => req.requirement_type === 'academic_qualification');
        const language = requirements.filter(req => req.requirement_type === 'language_proficiency');
        const testScore = requirements.filter(req => req.requirement_type === 'test_score');

        // Populate academic requirements
        if (academic.length > 0) {
            academicReqs.innerHTML = academic.map(req => `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium">${req.description || 'Academic Requirement'}</span>
                        ${req.is_mandatory ? '<span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full">Required</span>' : '<span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Recommended</span>'}
                    </div>
                    ${req.requirement_value ? `<p class="text-sm text-gray-600">Minimum: ${req.requirement_value}</p>` : ''}
                </div>
            `).join('');
        } else {
            academicReqs.innerHTML = '<p class="text-gray-500">No specific academic requirements listed. Please contact the university for details.</p>';
        }

        // Populate language requirements
        if (language.length > 0) {
            languageReqs.innerHTML = language.map(req => `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium">${req.test_type || 'Language Proficiency'}</span>
                        ${req.is_mandatory ? '<span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full">Required</span>' : '<span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Recommended</span>'}
                    </div>
                    ${req.requirement_value ? `<p class="text-sm text-gray-600">Minimum Score: ${req.requirement_value}</p>` : ''}
                    ${req.description ? `<p class="text-sm text-gray-600 mt-1">${req.description}</p>` : ''}
                </div>
            `).join('');
        } else {
            languageReqs.innerHTML = '<p class="text-gray-500">No specific language requirements listed. Please contact the university for details.</p>';
        }

        // Populate test score requirements
        if (testScore.length > 0) {
            testScoreReqs.innerHTML = testScore.map(req => `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium">${req.test_type || 'Test Score'}</span>
                        ${req.is_mandatory ? '<span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full">Required</span>' : '<span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">Recommended</span>'}
                    </div>
                    ${req.requirement_value ? `<p class="text-sm text-gray-600">Minimum Score: ${req.requirement_value}</p>` : ''}
                    ${req.description ? `<p class="text-sm text-gray-600 mt-1">${req.description}</p>` : ''}
                </div>
            `).join('');
        } else {
            testScoreReqs.innerHTML = '<p class="text-gray-500">No specific test score requirements listed. Please contact the university for details.</p>';
        }
    }

    async function loadSimilarPrograms(programId) {
        try {
            const similarPrograms = await apiCall(`/programs/${programId}/similar?limit=3`);
            const container = document.getElementById('similarPrograms');
            
            if (similarPrograms && similarPrograms.length > 0) {
                container.innerHTML = similarPrograms.map(program => `
                    <div class="bg-white border border-gray-border rounded-xl p-6 hover:shadow-md transition">
                        <div class="mb-4">
                            <h3 class="font-semibold text-lg mb-2">${program.program_name || program.name}</h3>
                            <p class="text-sm text-gray-600">${program.university_name} â€¢ ${program.country}</p>
                            <p class="text-sm text-gray-500 mt-1">${program.field_of_study}</p>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-xs px-2 py-1 rounded-full bg-primary/10 text-primary">${program.degree_level}</span>
                            <button onclick="viewProgramDetails(${program.program_id || program.id})" class="text-primary hover:text-blue-600 font-medium text-sm">
                                View Details
                            </button>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">No similar programs found.</p>';
            }
        } catch (error) {
            console.error('Error loading similar programs:', error);
            document.getElementById('similarPrograms').innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">Unable to load similar programs.</p>';
        }
    }

    function viewProgramDetails(programId) {
        window.location.href = `/program-detail?id=${programId}`;
    }

    // Button event handlers
    document.addEventListener('DOMContentLoaded', function() {
        const applyBtn = document.getElementById('applyNowBtn');
        const saveBtn = document.getElementById('saveToFavoritesBtn');
        const shareBtn = document.getElementById('shareBtn');

        if (applyBtn) {
            applyBtn.addEventListener('click', function() {
                if (currentProgram && currentProgram.university && currentProgram.university.website) {
                    window.open(currentProgram.university.website, '_blank');
                } else {
                    alert('Please contact the university directly for application information.');
                }
            });
        }

        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                // TODO: Implement save to favorites functionality
                alert('Save to favorites feature coming soon!');
            });
        }

        if (shareBtn) {
            shareBtn.addEventListener('click', function() {
                if (navigator.share) {
                    navigator.share({
                        title: currentProgram ? currentProgram.name : 'Program Details',
                        url: window.location.href
                    });
                } else {
                    // Fallback to copying URL
                    navigator.clipboard.writeText(window.location.href);
                    alert('Program URL copied to clipboard!');
                }
            });
        }
    });
</script>

</body>
</html>
